@page "/presenter/quiz"
@inject QuizManager QuizManager
@rendermode InteractiveServer
@implements IDisposable

<PageTitle>Quiz @Id</PageTitle>
@if (Id == "")
{
	<p>Quizz not available</p>
}
<h3>Quiz: @Id</h3>

@if (activeQuiz != null)
{
	<section>
		<div>
			<h2>Question: @activeQuiz.Questions[currentQuestionIndex].Text</h2>
			@* @foreach (var answer in activeQuiz.Questions[currentQuestion].Answers)
			{
				<div>@answer</div>
			} *@
			@for (int i = 0; i < activeQuiz.Questions[currentQuestionIndex].Answers.Count; i++)
			{
				<div>
					<p>Answer: @activeQuiz.Questions[currentQuestionIndex].Answers[i]</p>
					<p>Votes: @activeQuiz.Questions[currentQuestionIndex].VoteCount[i]</p>
				</div>
			}


			<button onclick="@NextQuestion">Next</button>
		</div>
	</section>
}

@code {
	[SupplyParameterFromQuery]
	private string Id { get; set; }
	private Quiz activeQuiz;
	private int currentQuestionIndex;
	protected override void OnInitialized()
	{
		QuizManager.OnStateChanged += Refresh;

		activeQuiz = QuizManager.GetQuiz(Id);
		if (activeQuiz != null)
		{
			currentQuestionIndex = activeQuiz.CurrentQuestionIndex;
		}

		Refresh();

	}
	public void NextQuestion()
	{
		currentQuestionIndex++;
	}

	public void Refresh()
	{
		InvokeAsync(StateHasChanged);
	}

	public void Dispose()
	{
		QuizManager.OnStateChanged -= Refresh;
	}

}